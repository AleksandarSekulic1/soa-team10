<div class="container">
  <h1>All Tours</h1>

  <div class="tours-grid">
    <div *ngFor="let tour of allTours" class="tour-card">
      <h3>{{ tour.name }}</h3>
      <p><strong>Author:</strong> {{ tour.authorId }}</p>
      <p>{{ tour.description }}</p>
      <div class="reviews-section">
        <h4>Reviews ({{ tour.reviews?.length || 0 }})</h4>
        <ul>
          <li *ngFor="let review of tour.reviews">
            <div class="review-header">
              <strong>Rating: {{ review.rating }}/5</strong>
              <!-- Displaying the formatted comment date -->
              <small>{{ review.commentDate | date:'dd.MM.yyyy. HH:mm' }}</small>
            </div>
            <p class="review-comment">"{{ review.comment }}" <small>(by {{ review.touristId }})</small></p>
            <!-- Displaying images if they exist -->
            <div *ngIf="review.imageUrls && review.imageUrls.length > 0" class="review-images">
              <img *ngFor="let imageUrl of review.imageUrls" [src]="imageUrl" alt="Review image">
            </div>
          </li>
        </ul>
      </div>
      <button *ngIf="authService.isTourist()" (click)="selectTourForReview(tour)">Rate This Tour</button>
    </div>
  </div>
</div>

<!-- Modal for writing a review -->
<div class="modal-overlay" *ngIf="selectedTour">
  <div class="modal-content">
    <h3>Rate Tour: {{ selectedTour.name }}</h3>
    <form (ngSubmit)="submitReview()">
      <div class="form-group">
        <label for="rating">Rating (1-5):</label>
        <input type="number" name="rating" [(ngModel)]="review.rating" min="1" max="5" required>
      </div>
      <div class="form-group">
        <label for="comment">Comment:</label>
        <textarea name="comment" [(ngModel)]="review.comment" rows="4"></textarea>
      </div>
      <div class="form-group">
        <label for="visitDate">Date of visit:</label>
        <input type="date" name="visitDate" [(ngModel)]="review.visitDate" required>
      </div>
      <!-- NEW FIELD FOR IMAGES -->
      <div class="form-group">
        <label for="imageUrls">Image links (comma-separated):</label>
        <input type="text" name="imageUrls" [(ngModel)]="review.imageUrlsInput">
      </div>
      <div class="modal-actions">
        <button type="submit">Submit Review</button>
        <button type="button" (click)="selectedTour = null">Cancel</button>
      </div>
    </form>
  </div>
</div>
